{
  "openapi": "3.1.0",
  "info": {
    "title": "repo-bridge",
    "version": "1.2.0"
  },
  "servers": [
    {
      "url": "https://repo-bridge.onrender.com"
    }
  ],
  "paths": {
    "/list": {
      "post": {
        "operationId": "listDirectory",
        "summary": "List files and directories in a GitHub repository. Can target any accessible repo by changing the repo parameter.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["repo", "path"],
                "properties": {
                  "repo": {
                    "type": "string",
                    "description": "Repository in owner/name format. Can be any accessible repo."
                  },
                  "path": {
                    "type": "string",
                    "description": "Directory path. Use empty string for repository root."
                  },
                  "branch": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Directory listing with entries array",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/read": {
      "post": {
        "operationId": "readFile",
        "summary": "Read a file from any accessible GitHub repository. Change the repo parameter to read from different repos.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["repo", "path"],
                "properties": {
                  "repo": {
                    "type": "string",
                    "description": "Repository in owner/name format. Can be any accessible repo."
                  },
                  "path": {
                    "type": "string"
                  },
                  "branch": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File contents with ok, content, sha, size fields",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/batch/read": {
      "post": {
        "operationId": "batchRead",
        "summary": "Read multiple files from one or more repos in a single call. Each file can target a different repository. Max 10 files.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["files"],
                "properties": {
                  "files": {
                    "type": "array",
                    "description": "Array of files to read. Each entry has repo (owner/name), path, and optional branch. Each can target a different repository.",
                    "items": {
                      "type": "object",
                      "required": ["repo", "path"],
                      "properties": {
                        "repo": {
                          "type": "string",
                          "description": "Repository in owner/name format"
                        },
                        "path": {
                          "type": "string"
                        },
                        "branch": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Array of file read results in files field. Each has ok, content, owner, repo, path. Individual reads can fail without failing the batch.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/copy": {
      "post": {
        "operationId": "copyFile",
        "summary": "Copy a file from one repository to another in a single call. Reads from source repo and writes to destination repo.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["source", "srcPath", "destination"],
                "properties": {
                  "source": {
                    "type": "string",
                    "description": "Source repository in owner/name format"
                  },
                  "srcPath": {
                    "type": "string",
                    "description": "File path in the source repository"
                  },
                  "srcBranch": {
                    "type": "string",
                    "description": "Source branch. Defaults to main."
                  },
                  "destination": {
                    "type": "string",
                    "description": "Destination repository in owner/name format"
                  },
                  "destPath": {
                    "type": "string",
                    "description": "File path in destination. Defaults to same as srcPath."
                  },
                  "destBranch": {
                    "type": "string",
                    "description": "Destination branch. Defaults to main."
                  },
                  "message": {
                    "type": "string",
                    "description": "Commit message. Auto-generated if omitted."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Copy result with source and destination details including commit SHA",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/apply": {
      "post": {
        "operationId": "applyFile",
        "summary": "Create or update files in a GitHub repository. Supports single file (path+content) or multiple files (changes array).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["repo", "path", "content", "message"],
                "properties": {
                  "repo": {
                    "type": "string",
                    "description": "Repository in owner/name format. Can target any writable repo."
                  },
                  "path": {
                    "type": "string"
                  },
                  "content": {
                    "type": "string"
                  },
                  "message": {
                    "type": "string"
                  },
                  "branch": {
                    "type": "string"
                  },
                  "dryRun": {
                    "type": "boolean",
                    "description": "If true, preview only without committing. Makes no GitHub API calls."
                  },
                  "changes": {
                    "type": "array",
                    "description": "Alternative to path+content. Array of {path, content} objects for multi-file writes to the same repo.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "path": {
                          "type": "string"
                        },
                        "content": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Apply result with commitSha, created/updated flags",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/github/dryrun": {
      "post": {
        "operationId": "dryRun",
        "summary": "Preview a file change without committing. Makes NO GitHub API calls. Use to verify changes before /apply.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["repo", "path", "content", "message"],
                "properties": {
                  "repo": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string"
                  },
                  "content": {
                    "type": "string"
                  },
                  "message": {
                    "type": "string"
                  },
                  "branch": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dry run result showing what would be applied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "operationId": "healthCheck",
        "summary": "Check service status",
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  }
}
